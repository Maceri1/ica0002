---
- name: Initial setup
  hosts: all
  roles:
    - init
    
- name: DNS servers
  hosts: dns_servers
  roles:
    - bind
    
- name: Resolver
  hosts: all
  roles: 
    - resolver

- name: Prometheus server
  hosts: prometheus
  roles:
    - prometheus
    - nginx
    
- name: Database server
  hosts: db_servers
  roles:
    - mysql
  tags:
    - mx

- name: InfluxDB server
  hosts: influxdb
  roles:
    - influxdb

- name: Keepalived
  hosts: keepalived
  roles: 
    - keepalived
  
- name: Haproxy
  hosts: haproxy
  roles:
    - haproxy

- name: Web server
  hosts: web_servers
  roles:
    - docker
    - agama
    - nginx
  tags:
    - mx
    
- name: Grafana server
  hosts: grafana
  roles:
    - docker
    - nginx
    - grafana

- name: Agama client
  hosts: agama_clients
  roles:
    - agama_client